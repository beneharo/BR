<!DOCTYPE html> 
<html> 
<head> 
    <title>BR</title> 
    
    <meta name="viewport" content="width=device-width, initial-scale=1, charset=utf-8"> 

    <link rel="stylesheet" href="./js/jquery.mobile-1.2.0.min.css" />
    <script src="./js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/jquery.raty.min.js"></script>
    <script src="./js/jquery.mobile-1.2.0.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="./js/cordova-2.2.0.js"></script>
    <script src="js/barcodescanner.js"></script>
    <script>
    var idL;
    var GPSlatitud;
    var GPSlongitud;

    // Función error al escenar BARCODE
    function scanerror(error) {
        alert("Fallo al escanear: " + error);
    }
    
    // Función éxito al escanear BARCODE
    function scansuccess(result) {
        idL = result.text;
        $('#idLocal').val(idL); // Asigna el valor al TextField del Formulario.
        navigator.geolocation.getCurrentPosition(onSuccess, onError);
    }
    
    // Acierto en la lectura GPS.
    var onSuccess = function(position) {
        GPSlatitud = position.coords.latitude;
        GPSlongitud = position.coords.longitude;
        //alert(GPSlatitud + ' ,' + GPSlongitud);
    };

    // Fallo en la lectura GPS.
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    };
    
    // Función para escanear código.
    function scan() {    
        window.plugins.barcodeScanner.scan(scansuccess, scanerror);
    }
    
    function enviarDatos(){
        $.ajax({
            async:  true, 
            data:   {
            	idLocal :  $('#idLocal').val(),
            	servicio : $('#servicio').val(),
            	calidad_servicio : $('#calidad_servicio').val(),
            	atencion_cliente : $('#atencion_cliente').val(),
            	estado_instalaciones : $('#estado_instalaciones').val(),
            	email_usuario : $('#email_usuario').val(),
            	comentario : $('#comentario').val()
            },
            url:    "http://iibr.vv.si/datos.php",
            type:   "post",
            dataType:"html"
         });

    }
    
    </script>
    
</head> 

<body> 
<!-- Principal -->   
<div data-role="page" id="mainpage">

    <div data-role="header">
        <h1>BR: Your best choice!</h1>
    </div><!-- /header -->

    <div data-role="content">     
        <a href="#valoracion" data-rel="page" data-role="button" onclick="scan()">Realizar Valoración</a>
        <a href="#popupOpciones" id ="botonPopUp" data-role="button" data-rel="popup">Sugerencia</a>
    </div>
    
    <div data-role="popup" id="popupOpciones">
                <div>Servicios</div>
                <a href="#" id ="boton" data-role="button">Hoteles</a>
                <a href="#" id ="boton" data-role="button">Restaurantes</a>
                <a href="#" id ="boton" data-role="button">Compras</a>
                <a href="#popupOpciones2" id ="boton" data-role="button" data-rel="popup">Otros</a>
                <a href="#pagina2" id ="boton" data-role="button">Volver</a>
            </div>
            
             <div data-role="popup" id="popupOpciones2">
                <input type="text" name="search" placeholder="¿Servicios?"/>
                <a href="#" id ="boton" data-role="button">Sugiéreme</a>
                <a href="#popupOpciones" id ="boton" data-role="button" data-rel="popup">Volver</a>
             </div>

    <div data-role="footer">
        <h4>GPL 2012</h4>
    </div>
</div>


<!-- Valoración -->
<div data-role="page" id="valoracion">
    
    <div data-role="none">
 
	    <script type="text/javascript"> 
	        $(function() { 
	            $('#servicio').raty({ 
	                cancel     : true, 
	                cancelOff  : 'cancel-off-big.png', 
	                cancelOn   : 'cancel-on-big.png',  
	                size       : 24, 
	                starOff    : 'star-off-big.png', 
	                starOn     : 'star-on-big.png',
	                click      : function(score) {
			                	   $('#servicio').val(score);
			                	 }
	            }); 
	            $('#calidad_servicio').raty({ 
                    cancel     : true, 
                    cancelOff  : 'cancel-off-big.png', 
                    cancelOn   : 'cancel-on-big.png',  
                    size       : 24, 
                    starOff    : 'star-off-big.png', 
                    starOn     : 'star-on-big.png',
                    click      : function(score) {
                                   $('#calidad_servicio').val(score);
                                 }
                });
	            $('#atencion_cliente').raty({ 
                    cancel     : true, 
                    cancelOff  : 'cancel-off-big.png', 
                    cancelOn   : 'cancel-on-big.png',  
                    size       : 24, 
                    starOff    : 'star-off-big.png', 
                    starOn     : 'star-on-big.png',
                    click      : function(score) {
                                   $('#atencion_cliente').val(score);
                                 }
                });
	            $('#estado_instalaciones').raty({ 
                    cancel     : true, 
                    cancelOff  : 'cancel-off-big.png', 
                    cancelOn   : 'cancel-on-big.png',  
                    size       : 24, 
                    starOff    : 'star-off-big.png', 
                    starOn     : 'star-on-big.png',
                    click      : function(score) {
                                   $('#estado_instalaciones').val(score);
                                 }
                }); 
	        }); 
	    </script>
            
        <form action="#" method="post" data-theme="c">
            
            <div data-role="fieldcontain">
                <input type="text" name="idLocal" id="idLocal" value=""/>
            </div>

            <div data-role="fieldcontain">
                <legend>Servicio:</legend>
                <div id="servicio" name="servicio" value=""></div>
            </div>
            <div data-role="fieldcontain">
                <legend>Calidad Servicio:</legend>
                <div id="calidad_servicio" name="calidad_servicio" value=""></div>
            </div>
            <div data-role="fieldcontain">
                <legend>Calidad Servicio:</legend>
                <div id="atencion_cliente" name="atencion_cliente" value=""></div>
            </div>
            <div data-role="fieldcontain">
                <legend>Calidad Servicio:</legend>
                <div id="estado_instalaciones" name="estado_instalaciones" value=""></div>
            </div>

		    <div data-role="fieldcontain">
                <legend>eMail usuario:</legend>
                <input type="text" name="email_usuario" id="email_usuario" value=""/>
            </div>
            <div data-role="fieldcontain">
                <label for="comentario">Comentario:</label>
	            <textarea name="comentario" id="comentario" style="width:100%"></textarea>
            </div>
            <div>
                <input type="submit" value="Enviar" onClick="enviarDatos()" />
            </div>
        </form>
    </div>
    <div data-role="footer">
        <h4>GPL 2012</h4>
    </div><!-- /footer -->
</div>


</body>
</html>